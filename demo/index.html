<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Cart Panel Demo</title>

		<!-- dialog-panel styles -->
		<link rel="stylesheet" href="https://unpkg.com/@magic-spells/dialog-panel/dist/dialog-panel.css" />
		<!-- quantity-input styles -->
		<link rel="stylesheet" href="https://unpkg.com/@magic-spells/quantity-input/dist/quantity-input.css" />
		<!-- cart-panel styles (includes cart-item) -->
		<link rel="stylesheet" href="./cart-panel.css" />

		<style>
			/* Demo page styles */
			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				margin: 0;
				padding: 0;
				min-height: 200vh;
				background-color: #f0f2f5;
				color: #333;
			}

			.hero-section {
				position: relative;
				height: 100vh;
				width: 100%;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				color: white;
				text-align: center;
				padding: 20px;
				box-sizing: border-box;
			}

			.hero-section h1 {
				font-size: 3rem;
				margin: 20px 0;
				text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
			}

			.hero-section p {
				font-size: 1.2rem;
				max-width: 600px;
				text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
				margin-bottom: 30px;
			}

			.content-section {
				padding: 50px 20px;
				max-width: 1200px;
				margin: 0 auto;
				min-height: 100vh;
			}

			.content-section h2 {
				font-size: 2rem;
				margin-bottom: 20px;
			}

			.content-section p {
				font-size: 1.1rem;
				line-height: 1.6;
				margin-bottom: 20px;
			}

			/* Prevent body scroll when dialog is open */
			body:has(dialog-panel[state='showing']),
			body:has(dialog-panel[state='shown']) {
				overflow: hidden;
			}

			/* Slide-from-right drawer override for dialog-panel */
			dialog-panel > dialog {
				position: fixed;
				top: 0;
				right: 0;
				left: auto;
				width: min(400px, 90vw);
				height: 100dvh;
				max-width: none;
				max-height: none;
				border: none;
				border-radius: 0;
				margin: 0;
				padding: 0;
				transform: translateX(100%);
				opacity: 1;
				transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
				display: flex;
				flex-direction: column;
				background: #fff;
				box-shadow: -5px 0 25px rgba(0, 0, 0, 0.15);
			}

			dialog-panel[state='showing'] > dialog,
			dialog-panel[state='shown'] > dialog {
				transform: translateX(0);
			}

			dialog-panel[state='hiding'] > dialog {
				transform: translateX(100%);
			}

			/* Cart panel styling */
			cart-panel {
				display: flex;
				flex-direction: column;
				height: 100%;
			}

			.cart-header {
				padding: 24px;
				border-bottom: 1px solid #eee;
				display: flex;
				justify-content: space-between;
				align-items: center;
				background: #f8f9fa;
			}

			.cart-header h2 {
				margin: 0;
				font-size: 1.5rem;
				color: #333;
			}

			.close-button {
				background: transparent;
				border: none;
				font-size: 24px;
				cursor: pointer;
				color: #666;
				width: 32px;
				height: 32px;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: background-color 0.2s;
			}

			.close-button:hover {
				background-color: rgba(0, 0, 0, 0.05);
			}

			.cart-body {
				flex: 1;
				overflow-y: auto;
				padding: 0;
			}

			.cart-items {
				display: flex;
				flex-direction: column;
			}

			.cart-footer {
				padding: 24px;
				border-top: 1px solid #eee;
				background: #f8f9fa;
			}

			.cart-total {
				font-size: 1.2rem;
				font-weight: bold;
				margin-bottom: 16px;
				text-align: center;
			}

			.checkout-button {
				width: 100%;
				padding: 16px;
				background-color: #28a745;
				color: white;
				border: none;
				border-radius: 6px;
				font-size: 16px;
				font-weight: 600;
				cursor: pointer;
				transition: background-color 0.2s;
			}

			.checkout-button:hover {
				background-color: #218838;
			}

			/* Cart item template styles */
			.sample-cart-item {
				display: flex;
				padding: 16px;
				border-bottom: 1px solid #eee;
				gap: 12px;
				align-items: center;
			}

			.item-image {
				width: 60px;
				height: 60px;
				background: #ddd;
				border-radius: 4px;
				flex-shrink: 0;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 24px;
			}

			.item-details {
				flex: 1;
			}

			.item-name {
				font-weight: 600;
				margin-bottom: 8px;
			}

			.item-controls {
				display: flex;
				flex-direction: column;
				justify-content: space-between;
				align-items: flex-end;
				min-height: 60px;
			}

			.remove-button {
				background: transparent;
				color: #666;
				border: none;
				padding: 4px;
				border-radius: 50%;
				cursor: pointer;
				font-size: 18px;
				font-weight: bold;
				width: 24px;
				height: 24px;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: background-color 0.2s, color 0.2s;
			}

			.remove-button:hover {
				background: #f0f0f0;
				color: #333;
			}

			.item-price {
				color: #666;
				font-size: 14px;
			}

			.trigger-button {
				padding: 12px 28px;
				background-color: #0077ff;
				color: #fff;
				border: none;
				cursor: pointer;
				font-size: 16px;
				font-weight: 600;
				border-radius: 6px;
				transition: all 0.2s ease;
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
				letter-spacing: 0.5px;
				margin-bottom: 20px;
			}

			.trigger-button:hover {
				background-color: #0066db;
				transform: translateY(-2px);
				box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
			}

			.trigger-button:active {
				transform: translateY(0);
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
			}

			.button-group {
				display: flex;
				gap: 10px;
				flex-wrap: wrap;
				margin-top: 20px;
			}

			.empty-cart {
				padding: 40px 20px;
				text-align: center;
				color: #666;
			}

			.empty-cart-icon {
				font-size: 48px;
				margin-bottom: 16px;
				opacity: 0.5;
			}

			/* Event log styling */
			.event-log {
				margin-top: 30px;
				padding: 15px;
				background-color: #f5f5f5;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
			}

			.event-log h3 {
				margin-top: 0;
				color: #333;
				font-size: 1.2rem;
			}

			.event-log ul {
				margin: 0;
				padding: 0;
				list-style: none;
			}

			.event-log li {
				padding: 8px 12px;
				margin-bottom: 8px;
				background-color: #fff;
				border-left: 4px solid #0077ff;
				border-radius: 4px;
				font-family: monospace;
				font-size: 0.9rem;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
			}

			.event-log li:last-child {
				border-left-color: #ff6b6b;
				font-weight: bold;
			}
		</style>
	</head>
	<body>
		<div class="hero-section">
			<button id="open-cart-btn" class="trigger-button">
				Open Shopping Cart (<span data-content-cart-count>0</span> items)
			</button>
			<h1>Cart Panel 1.0 Demo</h1>
			<p>Shopping cart panel with dialog-panel integration</p>
		</div>

		<div class="content-section">
			<h2>Cart Panel Features</h2>
			<p>This cart panel component demonstrates:</p>
			<ul>
				<li>Uses dialog-panel for modal behavior (native &lt;dialog&gt;)</li>
				<li>Slide-in animation from the right side</li>
				<li>Cart item management with smooth animations</li>
				<li>Shopify cart API integration (getCart, updateCartItem)</li>
				<li>Processing states during cart operations</li>
				<li>Event system (cart-panel:show, cart-panel:updated, etc.)</li>
				<li>Native focus trap and escape key handling</li>
			</ul>

			<div class="button-group">
				<button id="add-item-btn" class="trigger-button" style="background-color: #28a745">
					Add Random Item
				</button>
				<button id="clear-cart-btn" class="trigger-button" style="background-color: #dc3545">
					Clear Cart
				</button>
			</div>
		</div>

		<!-- Cart with dialog-panel wrapper -->
		<dialog-panel id="cart-dialog">
			<dialog aria-labelledby="cart-title">
				<cart-panel manual>
					<div class="cart-header">
						<h2 id="cart-title">Shopping Cart</h2>
						<button aria-label="Close cart" class="close-button" data-action-hide-cart>
							&times;
						</button>
					</div>
					<div class="cart-body">
						<!-- Cart has items section -->
						<div data-cart-has-items>
							<div class="cart-items" data-content-cart-items>
								<!-- Cart items rendered dynamically -->
							</div>
						</div>

						<!-- Cart is empty section -->
						<div data-cart-is-empty>
							<div class="empty-cart">
								<div class="empty-cart-icon">ðŸ›’</div>
								<p>Your cart is empty</p>
								<p>Add some items to get started!</p>
							</div>
						</div>
					</div>
					<div class="cart-footer">
						<div class="cart-total">Subtotal: <span data-content-cart-subtotal>$0.00</span></div>
						<button class="checkout-button">Proceed to Checkout</button>
					</div>
				</cart-panel>
			</dialog>
		</dialog-panel>

		<script type="module">
			// Import components
			import 'https://unpkg.com/@magic-spells/dialog-panel/dist/dialog-panel.esm.js';
			import 'https://unpkg.com/@magic-spells/quantity-input/dist/quantity-input.esm.js';
			import './cart-panel.esm.js';

			// Get elements
			const cartPanel = document.querySelector('cart-panel');
			const openCartBtn = document.getElementById('open-cart-btn');
			const addItemBtn = document.getElementById('add-item-btn');
			const clearCartBtn = document.getElementById('clear-cart-btn');

			// Sample items for adding to cart
			const sampleItems = [
				{ name: 'Wireless Headphones', price: 99.99, emoji: 'ðŸŽ§' },
				{ name: 'Smartphone Case', price: 24.99, emoji: 'ðŸ“±' },
				{ name: 'USB Cable', price: 12.99, emoji: 'ðŸ”Œ' },
				{ name: 'Laptop Stand', price: 45.99, emoji: 'ðŸ’»' },
				{ name: 'Coffee Mug', price: 15.99, emoji: 'â˜•' },
				{ name: 'Notebook', price: 8.99, emoji: 'ðŸ““' },
			];

			// Set up cart item template
			cartPanel.setCartItemTemplate('default', (itemData, cartData) => {
				const price = (itemData.line_price / 100).toFixed(2);
				const emoji = itemData.properties?.emoji || 'ðŸ“¦';

				return `
					<div class="sample-cart-item">
						<div class="item-image">${emoji}</div>
						<div class="item-details">
							<div class="item-name">${itemData.product_title}</div>
							<quantity-input value="${itemData.quantity}" min="1">
								<button data-action-decrement type="button">âˆ’</button>
								<input type="number" />
								<button data-action-increment type="button">+</button>
							</quantity-input>
						</div>
						<div class="item-controls">
							<button class="remove-button" data-action-remove-item>&times;</button>
							<div class="item-price" data-content-line-price>$${price}</div>
						</div>
					</div>
				`;
			});

			// Simulate cart data for demo
			let simulatedCartData = {
				item_count: 3,
				items: [
					{
						key: '1',
						id: '1',
						product_title: 'Wireless Headphones',
						quantity: 1,
						line_price: 9999,
						properties: { emoji: 'ðŸŽ§' },
					},
					{
						key: '2',
						id: '2',
						product_title: 'Smartphone Case',
						quantity: 2,
						line_price: 2499,
						properties: { emoji: 'ðŸ“±' },
					},
					{
						key: '3',
						id: '3',
						product_title: 'USB Cable',
						quantity: 1,
						line_price: 1299,
						properties: { emoji: 'ðŸ”Œ' },
					},
				],
			};

			// Override cart APIs to use simulated data
			cartPanel.getCart = function () {
				return Promise.resolve(simulatedCartData);
			};

			cartPanel.updateCartItem = function (key, quantity) {
				return new Promise((resolve) => {
					// Simulate network delay
					setTimeout(() => {
						const itemIndex = simulatedCartData.items.findIndex(
							(item) => (item.key || item.id) === key
						);
						if (itemIndex !== -1) {
							if (quantity === 0) {
								simulatedCartData.items.splice(itemIndex, 1);
							} else {
								simulatedCartData.items[itemIndex].quantity = quantity;
							}
						}
						simulatedCartData.item_count = simulatedCartData.items.reduce(
							(sum, item) => sum + item.quantity,
							0
						);
						resolve(simulatedCartData);
					}, 300);
				});
			};

			// Load initial cart data
			cartPanel.refreshCart();

			// Open cart button
			openCartBtn.addEventListener('click', (e) => {
				cartPanel.show(e.target);
			});

			// Add item functionality
			addItemBtn.addEventListener('click', () => {
				const randomItem = sampleItems[Math.floor(Math.random() * sampleItems.length)];
				const newItemKey = Date.now().toString();
				const newItem = {
					key: newItemKey,
					id: newItemKey,
					product_title: randomItem.name,
					quantity: 1,
					line_price: Math.round(randomItem.price * 100),
					properties: { emoji: randomItem.emoji },
				};

				simulatedCartData.items.push(newItem);
				simulatedCartData.item_count += 1;

				cartPanel.refreshCart().then(() => {
					logEvent('item-added', { item: randomItem.name });
				});
			});

			// Clear cart functionality
			clearCartBtn.addEventListener('click', () => {
				if (confirm('Are you sure you want to clear your cart?')) {
					simulatedCartData.items = [];
					simulatedCartData.item_count = 0;
					cartPanel.refreshCart().then(() => {
						logEvent('cart-cleared');
					});
				}
			});

			// Event listeners
			cartPanel
				.on('cart-panel:show', () => logEvent('cart-panel:show'))
				.on('cart-panel:hide', () => logEvent('cart-panel:hide'))
				.on('cart-panel:refreshed', () => logEvent('cart-panel:refreshed'))
				.on('cart-panel:updated', () => logEvent('cart-panel:updated'))
				.on('cart-panel:data-changed', (data) => {
					logEvent('cart-panel:data-changed', { count: data.calculated_count });
				});

			// Event logging
			const eventLog = document.createElement('div');
			eventLog.classList.add('event-log');
			eventLog.innerHTML = '<h3>Event Log:</h3><ul></ul>';
			document.querySelector('.content-section').appendChild(eventLog);

			function logEvent(eventName, detail = {}) {
				const list = eventLog.querySelector('ul');
				const item = document.createElement('li');
				let text = `${eventName} at ${new Date().toLocaleTimeString()}`;
				if (detail.item) text += ` (${detail.item})`;
				if (detail.count !== undefined) text += ` (count: ${detail.count})`;
				item.textContent = text;
				list.appendChild(item);

				// Limit to last 10 events
				if (list.children.length > 10) {
					list.removeChild(list.firstChild);
				}
			}
		</script>
	</body>
</html>
